/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package favmovieapp;


import favmovieapp.Repositories.MovieRepository;
import favmovieapp.domains.Movies;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.apache.catalina.LifecycleException;
import org.apache.catalina.startup.Tomcat;

import java.io.IOException;

/** Class App is where the main functionality, user input and server creation takes place for the application.
 *
 */
public class App {

    public static void main(String[] args) {
        //App context. Builds framework of and returns the Service and Repository methods
        AppContext.build();
        int rankInput = 1;
        String searchInput = "Casablanca";
        System.out.println(AppContext.getMovieService().searchByName(searchInput));
        System.out.println(AppContext.getMovieService().searchByRank(rankInput));
        System.out.println(AppContext.getMovieRepository().getMovies().toString());
        //}
//}
        Tomcat server = new Tomcat();
        server.getConnector();
        server.addContext("", null);
        server.addServlet("", "moviesServlet", new HttpServlet() {
            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

                String searchInput = req.getParameter("name");
                if (searchInput != null) {
                    String result = AppContext.getMovieService().searchByName(searchInput);
                    resp.getWriter().println(result);
                } else {
                    for (Movies movies : MovieRepository.getMovies()) {
                        resp.getWriter().println(movies + "");
                    }
                    resp.getWriter().println("\n");
                }

            }
        }).addMapping("/movies");
        try {
            server.start();
        } catch (LifecycleException e) {
            e.printStackTrace();
            System.err.println("Server failed to start");
        }
    }
}
//}


